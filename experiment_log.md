# 概要
コードの分析結果やメモを記録

# 履歴
# 分析内容 Ver2.0
## 実施内容
- 4つのCSVの統合
- event_typeをワンホットエンコーディング
- 各特徴量の分布を確認

## 今後の予定
- データの前処理（特徴量）
- KMeans法を用いてクラスタリングを実施
- LightGBM、ランダムフォレストなどでClick・Purchseそれぞれの行動予測を実施

クラスタリング、行動予測はユーザー属性を示す特徴量、広告属性を示す特徴量、ユーザー・広告属性を統合した特徴量による3パターンを実施。
また、ユーザーセグメントｘ広告セグメントによる行動予測も実施予定

## 分析結果 Ver2.0
特徴量の分布は下記の通り
- 性別はやや男性寄り
- 年齢は20代がピーク。40代以上は少数
- 曜日による傾向さは見られない
- 国はアメリカ・イギリスが上位
- 広告タイプはストーリーズがやや多めだが、カルーセル・イメージ・動画それぞれ一定数あり
- 広告プラットフォームはFacebookとInstagramの2種類。Facebookが多め

# ユーザー特徴量でのクラスタリングの検証（Ver1.1）
## 🔄 実施内容
- 特徴量に以下を使用
"day_of_week","user_gender","user_age","hour_sin","hour_cos"
"art","fashion","finance","fitness","food","gaming","health","lifestyle","news","photography","sports","technology","travel"
- カテゴリカル変数として"day_of_week","user_gender"をワンホットエンコーディング
- k=5 を仮置きで設定
- 標準化＋PCAで2次元化して分布確認

10/20 追記
- 今回の結果をDBI（デイビス・ボールディン指数）とCH（カリンスキー・ハラバス指数）で評価
    DBI：クラスター間の分離の良さとクラスター内部の密集度のバランスを見る指標
        値が小さいほど良い（基準1.0未満なら許容。0.5未満なら良好）
    CH：クラスター間の分散とクラスター内部の分散の比率を見る指標
        値が大きいほど良い
    シルエットスコアも出したかったが、計算が重いため、今回は割愛
    
- 各クラスターの特徴量を可視化

## ⚙️ 使用データ
- users.csv
- events.csv

## 📊 現状の結果
- PCAのX軸は年齢の影響を強く受けている印象。（X軸のみでクラスタが決定されている状況）
- Y軸はカテゴリカル変数が多すぎて分散している。

10/20 追記
- 評価指標 
    DBI：2.618 のため、評価❌
    CH：26696.857のため、評価🟢
        ⇒クラスタ間の距離も内部の距離も大きいため、上手く分けられていない可能性が高い

- 各クラスタの特徴比較
    標準化したままで出力したため、年齢や時間の影響は読み取りにくいが、以下のことが分かった
    クラスタ0のみ年齢の値が大きい
    クラスタ毎に時刻（hour_sin,cos）の値の差が大きい
    各interestカテゴリの差はあまり見られない
    曜日の差もあまり見られない
    クラスタ0~2は性別差はあまり見られない（大体男性 55%前後、女性 35%前後、その他11%）が、クラスタ3では女性比率が81%、クラスタ4では男性比率が100%となっており、性別による傾向差が見られた
        ⇒年齢、時刻、性別がクラスタ分けに影響している

## 🚧 今後の課題
- カテゴリカル変数のエンコーディング方法を見直して再検証
day_of_week：周期エンコーディング など

- 各クラスタの特徴量確認時に年齢や時刻を標準化前の状態に戻して確認する
- 各クラスタのCTR、CVRも確認する

- 年齢の分布の偏りが大きいので、DBSCANによるクラスタリングも検証

# ユーザー特徴量でのクラスタリングの検証（Ver1.2）
## 🔄 実施内容（Ver1.1からの変更点）
- "day_of_week" をワンホットエンコーディング⇒周期エンコーディングに変更して検証
- 後処理として、年齢、時間、曜日を元に戻して各クラスタの特徴を確認

## 📊 現状の結果
- DBI：2.662、CH：26674.206 となり、曜日をワンホットエンコーディングでやったときよりも分離がなくなりわずかにスコアは悪化した。
- 各クラスタの特徴は下記の通り
    年齢ではクラスタ0~3は平均 24歳、4のみ41歳
    時間帯の平均値は全て11.5となり傾向差がみられない（平均だけで判断出来ないため、追って指標を追加）
    性別も全クラス 女性34~35%、男性55~56%、その他10%となり差分がなくなった。
    曜日については、クラスタ0が土日のみ、クラスタ1・3が水~金、クラスタ2が月～火、クラスタ4は前曜日均等という分かれ方になった。
    今回、指標は悪化したが、クラスタの分かれ方としては、年齢、及び曜日が影響している結果となった。

## 🚧 今後の課題
### 処理内容
- カテゴリカル変数のエンコーディング方法を見直して再検証
    興味関心のエンコーディングを変更
        ⇒まずは興味関心を外してみて影響があるか確認
- 年齢の分布の偏りが大きいので、DBSCANによるクラスタリングも検証

### 確認指標
- 各クラスタのCTR、CVRも確認する
- 時間帯について分布の確認も追加 

# ユーザー特徴量でのクラスタリングの検証（Ver1.3）
## 🔄 実施内容（Ver1.3からの変更点）
- 特徴量から興味関心カテゴリを外して検証

## 📊 現状の結果
- DBI：2.662 ⇒ 1.979、CH：26674.206 ⇒ 46550.501 に改善
- 2次元散布図での変化は見られず
- 各クラスタの特徴には変化なし（曜日や年齢による傾向が強い）

⇒興味関心がノイズになっていたと判断し、このまま外して検証を進める。

## 🚧 今後の課題
### 処理内容
- まず、k数の検証を実施
- 年齢の分布の偏りが大きいので、DBSCANによるクラスタリングも検証

### 確認指標
- 各クラスタのCTR、CVRも確認する
- 時間帯について分布の確認も追加 

# ユーザー特徴量でのクラスタリングの検証（Ver1.4）
## 🔄 実施内容（Ver1.3からの変更点）
- kを2~10の範囲で検証。DBI、CHの値で評価。

## 📊 現状の結果
- 結果は下記の通り
DBI最小はk=8
CH最大はk=2

k	DBI	CH
2	2.052676111	70638.56782
3	2.139396153	58059.83921
4	1.926125073	51925.8586
5	1.979236184	46550.50054
6	1.761140292	42648.06163
7	1.848851154	39727.23589
8	1.722359442	37885.87613
9	1.778697961	36006.16227
10	1.74626611	34484.86069


## 🚧 今後の課題
### 処理内容
- DBI,CHのバランスからk=4,6,8それぞれの分布図の可視化を作成し検証
